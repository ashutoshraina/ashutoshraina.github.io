<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="last-modified" content="2014-01-08T18:58:31.2512873+05:30" />
    <title>Ashutosh Raina</title>
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
    <link rel="shortcut icon" href="/stylesheets/images/me.png" type="image/png">
    <link rel="shortcut icon" type="image/png" href="/stylesheets/images/me.png" />
    <link rel="canonical" href="http://ashutoshraina.github.io/page2/" />
</head>
<body class="home blog">
    <div id="page" class="hfeed site">
        <header id="masthead" class="site-header fancy-container lightgreen" role="banner">
            <hgroup>
                <h1 class="site-title"><a href="/" title="ashutoshraina.github.io" rel="home">Ashutosh Raina</a></h1>
                <h2 class="site-title"><small>For those who are still chasing</small></h2>
                <p class="site-description">I love french fries!!</p>
            </hgroup>
            <nav role="navigation" class="site-navigation main-navigation">
                <h1 class="assistive-text">Menu</h1>
                <div class="assistive-text skip-link"><a href="#content" title="Skip to content">Skip to    content</a>
                </div>
                <div class="menu">
                    <ul>
                        <li><a href="/about">About</a></li>
                        <li><a href="/category">Categories</a></li>
                        <li><a href="/archive">Archive</a></li>
                        <li><a href="/feed.xml">RSS/Atom</a></li>
                    </ul>
                </div>
            </nav>
        </header>



        <div id="main">

            <div id="primary" class="site-content">
                <div id="content" role="main">
                  

  <ul class="posts">
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/10/mongodb-csharp-driver-part2/">MongoDB-CSharp-Driver Getting organised</a> 
        <span>posted on 04 Oct 2013</span>
      </h1> 
      <ul class="snow-series"><li><a href="/2013/10/mongodb-csharp-driver-part1/">Part 1 - Using Linq</a></li><li>Part 2 - Getting organised</li><li><a href="/2013/10/mongodb-csharp-driver-part3/">Part 3 - Getting Started</a></li></ul>
      <p>Having done the inital work for talking to MongoDB we can now create some POCO classes and then do some querying on top of it. As usual, my model is Questions and Users.</p>

<pre><code>public class Question : MongoEntity
{
    public string Text { get; set; }
    public string Answer { get; set; }
    public DateTime CreatedOn { get; set; }
    public int Difficulty { get; set; }
}
public class User : MongoEntity
{
    public string Name { get; set; }
    public int Reputation { get; set; }
}
</code></pre>


      <p><a href="/2013/10/mongodb-csharp-driver-part2/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/10/mongodb-csharp-driver-part3/">MongoDB-CSharp-Driver-Using Linq</a> 
        <span>posted on 04 Oct 2013</span>
      </h1> 
      <ul class="snow-series"><li><a href="/2013/10/mongodb-csharp-driver-part1/">Part 1 - Using Linq</a></li><li><a href="/2013/10/mongodb-csharp-driver-part2/">Part 2 - Getting organised</a></li><li>Part 3 - Getting Started</li></ul>
      <p>In the previous post we have seen some simple queries. It is time we move onto something more concrete and realistic. There are basically two ways of querying MongoDB with the driver. First, as I showed last time is using LINQ. To use LINQ we need to first move into the Queryable world and then proceed with actual querying.
Be careful about pulling all the documents locally and then performing operations on them. What we really want to do is offload all our querying to MongoDB and then only use the results. The driver implements the IQueryable interface and hence we should use it.</p>

<pre><code>var result = UserConnectionHandler.MongoCollection.AsQueryable()
                                  .Where(u =&gt; u.Reputation &gt; reputation);
</code></pre>


      <p><a href="/2013/10/mongodb-csharp-driver-part3/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/10/mongodb-csharp-driver-part1/">MongoDB-CSharp-Driver Getting started</a> 
        <span>posted on 03 Oct 2013</span>
      </h1> 
      <ul class="snow-series"><li>Part 1 - Using Linq</li><li><a href="/2013/10/mongodb-csharp-driver-part2/">Part 2 - Getting organised</a></li><li><a href="/2013/10/mongodb-csharp-driver-part3/">Part 3 - Getting Started</a></li></ul>
      <p>There are several drivers available for C#. I do not plan to go thorugh all of them here. Since, the official driver now has LINQ(although not complete yet) support, we will go with it.
Basic Setup..get the stuff of NuGet. It should put in two dll's in there 
1. MongoDB.Bson
2. MongoDB.Driver</p>

<p>We will get to what does what later. For now assume that we only want to get some data in and out of MongoDB.
Let's connect to MongoDB now(the code below is just quick and dirty, we will see a better version later).</p>

<pre><code>//MongoDB should be running by now, and assuming you have inserted some documents in there
var client = new MongoClient(@"mongodb://localhost");
var server = client.GetServer();
var database = server.GetDatabase("YourDataBaseName");
var mongoCollection = database.GetCollection("SomeCollectionName");
//Getting all the documents
var cursor = mongoCollection.AsQueryable();
cursor.ForEach(Console.WriteLine);  
</code></pre>


      <p><a href="/2013/10/mongodb-csharp-driver-part1/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/10/mongodb-schemadesign/">MongoDB-Schema Design</a> 
        <span>posted on 02 Oct 2013</span>
      </h1> 
      
      <p>This is a short post on Schema Design.</p>

<p>Schema Design in MongoDB</p>

<ul>
<li>Application Driven Schema is the best way to store data in MongoDB</li>
<li>MongoDB stores rich documents i.e. store embedded documents , arrays etc..</li>
<li>Joins happen at the application level not at the database level.</li>
<li>There are no constraints in the database.</li>
<li>No support for transactions.</li>
<li>Support for Atomic present operations is present.</li>
<li>Tip : Embed as much as you can.</li>
</ul>

<p>
      <p><a href="/2013/10/mongodb-schemadesign/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/10/mongodb-query/">MongoDB-Query</a> 
        <span>posted on 01 Oct 2013</span>
      </h1> 
      
      <p>Hopefully, the MongoDB set up in the last post is still working.
Let's create a database and name it <em>Awesome</em>(just because we can).</p>

<pre><code>&gt; use Awesome
switched to db Awesome
</code></pre>

<p>
      <p><a href="/2013/10/mongodb-query/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/10/mongodb-shell/">MongoDB-Shell</a> 
        <span>posted on 01 Oct 2013</span>
      </h1> 
      
      <p>MongoDB stores the documents in BSON format. It is a binary serialisation format and a super set of JSON.
It has more types than JSON which enables better integration with various languages that support these types. 
Languages like perl and JS have a smaller type system which can cause problems.
ObjectId which uniquely identifies a document in mongodb is also part of the bson specification.
<em>id field is the primary key which is of type ObjectId. 
It is immutable.
    _Object Id = 4-byte timestamp + machine id + process id + counter</em></p>


      <p><a href="/2013/10/mongodb-shell/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/09/mongodb-getting-started/">MongoDB-Getting Started</a> 
        <span>posted on 30 Sep 2013</span>
      </h1> 
      
      <p>MongoDB is a document database and I won't bore you with details about what it can do. MongoDB makes many claims, they are <a href="http://www.mongodb.org/" title="Here">here</a>. In short, MongoDB is a document database that stores data in a JSON format and then promises to make out lives easier. 
Installation instruction are varied depending on your OS etc..and the both varieties of bitness are also available. <a href="http://www.mongodb.org/downloads,"Download"">Download</a></p>

<p>The shell for MongoDB is a Javascript based one, so if you know a bit of JS then you will fly in there. Start mongod from the command line, this can be done by navigating to the bin directory of installation. Provide the dbpath(the place where it stores the data) as well.</p>

<p><img src="/stylesheets/images/posts/mongod.png" alt="Mongod" /></p>

<p>If you look at the output when we start the daemon (mongod = mongo-daemon) then the last line talks about a rest interface. This can be enable by passing the --rest flag when starting the instance. The port for viewing the webpage is also there.</p>

<p>Let's get into the mix of things by connecting to this mongod using the shell(mongo.exe). Navigate to the mongo directory and go mongo.exe.
By default this connects  to the test database. The prompt will say something like </p>

<pre><code>C:\Users\Ashutosh\mongodb\bin&gt;mongo.exe
MongoDB shell version: 2.4.1
connecting to: test
&gt; 
</code></pre>

<p>At any moment you can go back to mongod and check how many connections are open. Run a couple of commands like 
<em>show dbs
show collections</em> 
to see if everything is in order. </p>

<p>Create a new database by use yourdatabasename. The shell will switch it's context to that database(after creating it if it does not exist already.) 
Next, time we will do some stuff by creating some collections and then querying. This will be a longish series, hold on and let me smear you twitter timelines.</p>

      <p><a href="/2013/09/mongodb-getting-started/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/07/python-development-in-visual-studio/">Python Development in Visual Studio</a> 
        <span>posted on 20 Jul 2013</span>
      </h1> 
      
      <p><strong>What ..you must be mad !!</strong></p>

<p>IronPython has been around for some time now. Python tools for Visual Studio have recently been given a facelift. It has been lifted to become a more complete tool which we can use for Python development with Visual Studio.
I have recently been flirting with Python since it is easier and quicker to just get some stuff done in Python. It can easily be a second language for a C# developer and I do intend to keep it in my toolbox. There are alternatives available including but not limited to PyDev plugin for eclipse and Aptana Studio which comes with all the bells bundled together.</p>

<p>
      <p><a href="/2013/07/python-development-in-visual-studio/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/06/entity-framework-table-per-type-gotcha/">Entity Framework - Table Per Type Gotcha</a> 
        <span>posted on 02 Jun 2013</span>
      </h1> 
      
      <p>Entity Framework Table Per Type (TPT) implementation has a little gotcha ( little is really relative ). When we create table per type we will have orphan rows if the parent gets deleted and there will be orphan rows in the parent if the child gets deleted. This causes a funny picture to emerge with very bad consequences.</p>

<p><img src="/stylesheets/images/posts/fix-tpt.png" alt="Gotcha" /></p>

<p>Now, to get around this my simple workaround was to alter the relationships in my seed method.</p>

<pre><code>context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Match] DROP CONSTRAINT [FK_ParikshaDev.Match_ParikshaDev.Questions_QuestionId]" );
context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Match] ADD CONSTRAINT [FK_ParikshaDev.Match_ParikshaDev.Questions_QuestionId] FOREIGN KEY (QuestionId) REFERENCES [ParikshaDev].[Questions] (QuestionId) ON DELETE CASCADE" );

context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Brief] DROP CONSTRAINT [FK_ParikshaDev.Brief_ParikshaDev.Questions_QuestionId]" );
context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Brief] ADD CONSTRAINT [FK_ParikshaDev.Brief_ParikshaDev.Questions_QuestionId] FOREIGN KEY (QuestionId) REFERENCES [ParikshaDev].[Questions] (QuestionId) ON DELETE CASCADE" );

context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Choice] DROP CONSTRAINT [FK_ParikshaDev.Choice_ParikshaDev.Questions_QuestionId]" );
context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Choice] ADD CONSTRAINT [FK_ParikshaDev.Choice_ParikshaDev.Questions_QuestionId] FOREIGN KEY (QuestionId) REFERENCES [ParikshaDev].[Questions] (QuestionId) ON DELETE CASCADE" );

context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Custom] DROP CONSTRAINT [FK_ParikshaDev.Custom_ParikshaDev.Questions_QuestionId]" );
context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Custom] ADD CONSTRAINT [FK_ParikshaDev.Custom_ParikshaDev.Questions_QuestionId] FOREIGN KEY (QuestionId) REFERENCES [ParikshaDev].[Questions] (QuestionId) ON DELETE CASCADE" );
</code></pre>

<p><img src="/stylesheets/images/posts/foreign-key.png" alt="ForeignKey" /></p>

<p>There are things that can be better in this code. We can have the Schema name and the Table name statically typed with the help of the context. The relationship name was arrived at by making an educated guess about the relationships and then confirming them by having a look at the db that was generated previously. I would consider this as a bug in EF. I didn't see any way to configure this behaviour with the fluent api. I expected this to be clearly stated in the documentation or a flag or a switch be made available in the api for configuration.</p>

      <p><a href="/2013/06/entity-framework-table-per-type-gotcha/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/05/entity-framework-migrations/">Entity Framework - Migrations</a> 
        <span>posted on 13 May 2013</span>
      </h1> 
      
      <p>Migrations are needed in our day to day work and EF migrations story has become a lot better over the last year. When your database changes rapidly then migrations are needed to keep pace. Ofcourse this is nothing new, but it wasn't available in EF before.</p>

<p><strong>Enable Migrations*</strong></p>

<p>To enable the migrations go to Tools -&gt; Library Package Manager -&gt; Package Manager Console.
Type Enable-Migrations in the console.
-Force parameter is optionally available if you want to overwrite an existing migrations.

      <p><a href="/2013/05/entity-framework-migrations/">Read more...</a></p>
    </li>
  </ul> 

  <!-- Pagination links -->
  <div id="post-pagination" class="pagination">

   
      <p class="previous">
        <a href="/">Previous Page</a>
      </p>


    <p class="previous">
      <a href="/page3">Next Page</a>
    </p>

  </div>


                </div>
                <!-- #content -->
            </div>
            <!-- #primary .site-content -->      

 <div id="secondary" class="widget-area fancy-container lightred" role="complementary">
                <aside id="text-5" class="widget widget_text">
                    <h1 class="widget-title">Follow</h1>
                    <div class="textwidget logos">
                     <a href="https://twitter.com/ashutoshraina" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://twitter.com']);"><img src="/stylesheets/images/twitter.png"></a>
                     <a href="http://stackoverflow.com/users/802070/ashutosh-raina" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://stackoverflow.com']);"><img src="/stylesheets/images/stackoverflow.png"></a>
                    <a href="http://www.linkedin.com/pub/ashutosh-raina/11/165/328" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://www.linkedin.com']);"><img src="/stylesheets/images/linkedin.png"></a>                      
                    <a href="https://github.com/ashutoshraina" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://github.com']);"><img src="/stylesheets/images/github.png"></a>
                       
                  
                    </div>
                   <a href="http://stackexchange.com/users/422979">
<img src="http://stackexchange.com/users/flair/422979.png" width="208" height="58" alt="profile for ashutosh raina on Stack Exchange, a network of free, community-driven Q&A sites" title="profile for ashutosh raina on Stack Exchange, a network of free, community-driven Q&A sites">
</a>  
                
                <aside id="linkcat-6" class="widget widget_links">
                    <h1 class="widget-title">Other Blogs</h1>
                    <ul class='xoxo blogroll'>
                        <li><a href="http://www.hanselman.com/blog" target="_top" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://hanselman.com/']);">Scott Hanselman</a></li>
                        <li><a href="http://www.2guysfrommumbai.wordpress.com/" target="_top" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://www.2guysfrommumbai.wordpress.com']);">My Old blog</a></li>                        
                    </ul>
                    
                </aside>
                <aside id="archives-4" class="widget widget_archive">
                    <h1 class="widget-title">Archive</h1>
                    <ul class="posts">
                          <li><a href="/archive#2014January">January, 2014</a></li>
                          <li><a href="/archive#2013December">December, 2013</a></li>
                          <li><a href="/archive#2013November">November, 2013</a></li>
                          <li><a href="/archive#2013October">October, 2013</a></li>
                          <li><a href="/archive#2013September">September, 2013</a></li>
                          <li><a href="/archive#2013July">July, 2013</a></li>
                          <li><a href="/archive#2013June">June, 2013</a></li>
                          <li><a href="/archive#2013May">May, 2013</a></li>
                          <li><a href="/archive#2013April">April, 2013</a></li>
                          <li><a href="/archive#2013February">February, 2013</a></li>
                    </ul>
                </aside>
            </div>
            <!-- #secondary .widget-area -->

        </div>
        <!-- #main -->

        <footer id="colophon" class="site-footer" role="contentinfo">
            <div class="site-info">
                Powered by <a href="https://github.com/Sandra/Sandra.Snow" rel="generator">Sandra.Snow</a>.	
            </div>
            <!-- .site-info -->
        </footer>
        <!-- #colophon .site-footer -->
    </div>
    <!-- #page .hfeed .site -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src='/javascripts/prettify.js' type='text/javascript'></script>
    
    <script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(['_setAccount', 'UA-46699881-1']);
_gaq.push(['_trackPageview']);
        
(function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
})();
</script>
    
    <script type='text/javascript'>
      $(function () {
        $("pre code").parent().each(function () {
          if (!$(this).hasClass("prettyprint")) {
            $(this).addClass("prettyprint");
            a = true
          }
        });

        prettyPrint();
      });
    </script>
</body>
</html>
