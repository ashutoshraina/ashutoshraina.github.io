<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="last-modified" content="2015-01-12T22:56:26.2537096+05:30" />
    <title>Ashutosh Raina</title>
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
    <link rel="shortcut icon" href="/stylesheets/images/me.png" type="image/png">
    <link rel="shortcut icon" type="image/png" href="/stylesheets/images/me.png" />
	<link rel="stylesheet" type="text/css" href="/stylesheets/font-awesome/css/font-awesome.min.css" />
    <link rel="canonical" href="http://ashutoshraina.github.io/page2/" />
</head>
<body class="home blog">
    <div id="page" class="hfeed site">
        <header id="masthead" class="site-header fancy-container lightgreen" role="banner">
            <hgroup>
                <h1 class="site-title"><a href="/" title="ashutoshraina.github.io" rel="home">Ashutosh Raina</a></h1>
                <h2 class="site-title"><small>For those who are still chasing</small></h2>
                <p class="site-description">I love french fries!!</p>
            </hgroup>
            <nav role="navigation" class="site-navigation main-navigation">
                <h1 class="assistive-text">Menu</h1>
                <div class="assistive-text skip-link"><a href="#content" title="Skip to content">Skip to    content</a>
                </div>
                <div class="menu">
                    <ul>
						<li><a href="/" class="home"><i class="fa fa-home"></i></a></li>
                        <li><a href="/archive">Archive</a></li>
                        <li><a href="/category">Categories</a></li>                        
                        <li><a href="/about">About</a></li>
                        <li><a href="/feed.xml">RSS/Atom</a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <div id="main">

            <div id="primary" class="site-content">
                <div id="content" role="main">
                  

  <ul class="posts">
    <li class="post">
      <h1><a href="/2013/12/tasks-with-timeout-net4.5-contd/">Tasks With Timeout On .net 4.5 Contd.</a></h1> 
      <div class="meta">
        <p class="posted">30 Dec 2013</p>
        <ul class="categories">
          <li><a href="/category/.net" title=".net">.net</a></li>
          <li><a href="/category/csharp" title="csharp">csharp</a></li>
          <li><a href="/category/Asynchrony" title="Asynchrony">Asynchrony</a></li>
        </ul>
      </div>
      <ul class="snow-series"><li><a href="/2013/12/tasks-with-timeouts/">Part 1 - Tasks With Timeouts</a></li><li><a href="/2013/12/tasks-with-timeout-contd/">Part 2 - Tasks With Timeouts contd.</a></li><li>Part 3 - Tasks With Timeout on .net4.5</li></ul>
      <p>The previous two posts looked at creating tasks with timeouts on .net4. The code as expected took some heavy lifting to get going. Understanding the extension methods themselves took some time. Today, using .net 4.5 this can be made a lot easier. Can we do better ? Yes we can !!</p>

<pre><code>    public static Task WithTimeout(this Task task, TimeSpan timeout)
    {
        var delay = task.ContinueWith(t =&gt; { }, new CancellationTokenSource(timeout).Token);
        return Task.WhenAny(task, delay).Unwrap();
    }
    public static Task&lt;T&gt; WithTimeout&lt;T&gt;(this Task&lt;T&gt; task, TimeSpan timeout)
    {            
        var delay = task.ContinueWith(t =&gt; t.Result, new CancellationTokenSource(timeout).Token);
        return Task.WhenAny(task, delay).Unwrap();
    }
</code></pre>

<p>
      <p><a href="/2013/12/tasks-with-timeout-net4.5-contd/">Read more...</a></p>
    </li>
    <hr/>
    <li class="post">
      <h1><a href="/2013/12/tasks-with-timeout-contd/">Tasks With Timeout Contd.</a></h1> 
      <div class="meta">
        <p class="posted">24 Dec 2013</p>
        <ul class="categories">
          <li><a href="/category/.net" title=".net">.net</a></li>
          <li><a href="/category/csharp" title="csharp">csharp</a></li>
          <li><a href="/category/Asynchrony" title="Asynchrony">Asynchrony</a></li>
        </ul>
      </div>
      <ul class="snow-series"><li><a href="/2013/12/tasks-with-timeouts/">Part 1 - Tasks With Timeouts</a></li><li>Part 2 - Tasks With Timeouts contd.</li><li><a href="/2013/12/tasks-with-timeout-net4.5-contd/">Part 3 - Tasks With Timeout on .net4.5</a></li></ul>
      <p>As mentioned in the last post we can now have tasks with individual timeouts. The code looked a little heavy. Can we do better ? Yes we can !!</p>

<pre><code>    var tasks = new List&lt;Task&gt;();
    try
    {
    //instead of checking for fault within the continutaion, 
    //we can just use a TaskContinuationOption to tell communicate the right semantics

    var t1 = Task.Factory.StartNew(_ =&gt; LongRunningTask(),TaskCreationOptions.AttachedToParent)
    .TimeoutAfter(1000)
    .ContinueWith(t =&gt; SomethingUsefulWithTheResult(), 
     TaskContinuationOptions.NotOnFaulted);

    var t2 = Task.Factory.StartNew(_ =&gt; LongRunningTask(), TaskCreationOptions.AttachedToParent)
      .ContinueWith(t =&gt; SomethingUsefulWithTheResult());

    var t3 = Task.Factory.StartNew(_ =&gt; LongRunningTask("Entering task3"),
    TaskCreationOptions.AttachedToParent)
      .ContinueWith(t =&gt; SomethingUsefulWithTheResult());

    tasks.Add(t1);
    tasks.Add(t2);
    tasks.Add(t3);

    Task.WaitAll(tasks.ToArray());
    }
    catch (Exception ex)
    {
    Console.WriteLine("There was an exception");
    Console.WriteLine(ex.InnerException.Message);   
    }
</code></pre>

<p>I will show in the next post how this wasn't all that better since this leaves a few gaps.</p>

      <p><a href="/2013/12/tasks-with-timeout-contd/">Read more...</a></p>
    </li>
    <hr/>
    <li class="post">
      <h1><a href="/2013/12/tasks-with-timeouts/">Tasks With Timeout</a></h1> 
      <div class="meta">
        <p class="posted">23 Dec 2013</p>
        <ul class="categories">
          <li><a href="/category/.net" title=".net">.net</a></li>
          <li><a href="/category/csharp" title="csharp">csharp</a></li>
          <li><a href="/category/Asynchrony" title="Asynchrony">Asynchrony</a></li>
        </ul>
      </div>
      <ul class="snow-series"><li>Part 1 - Tasks With Timeouts</li><li><a href="/2013/12/tasks-with-timeout-contd/">Part 2 - Tasks With Timeouts contd.</a></li><li><a href="/2013/12/tasks-with-timeout-net4.5-contd/">Part 3 - Tasks With Timeout on .net4.5</a></li></ul>
      <p>So the task is to timeout a task. now, I never thought it would take me as long as it did. Turns out it is a really tricky problem problem. I was expecting something within the framework to make life easier, there isn't anything by default but msdn to the rescue 
<a href="http://blogs.msdn.com/b/pfxteam/archive/2011/11/10/10235834.aspx" title="Tasks With Timeout">Tasks With Timeouts</a></p>


      <p><a href="/2013/12/tasks-with-timeouts/">Read more...</a></p>
    </li>
    <hr/>
    <li class="post">
      <h1><a href="/2013/11/mongodb-sharding/">MongoDB-Sharding</a></h1> 
      <div class="meta">
        <p class="posted">05 Nov 2013</p>
        <ul class="categories">
          <li><a href="/category/.net" title=".net">.net</a></li>
          <li><a href="/category/csharp" title="csharp">csharp</a></li>
          <li><a href="/category/mongodb" title="mongodb">mongodb</a></li>
          <li><a href="/category/opensource" title="opensource">opensource</a></li>
        </ul>
      </div>
      <ul class="snow-series"><li><a href="/2013/10/mongodb-ops-stuff/">Part 1 - Ops Stuff</a></li><li><a href="/2013/10/mongodb-indexing/">Part 2 - Indexing</a></li><li><a href="/2013/10/mongodb-understanding-your-queries-through-explainplan/">Part 3 - Explain Plan</a></li><li><a href="/2013/11/mongodb-replication/">Part 4 - Replication</a></li><li>Part 5 - Sharding</li></ul>
      <p><strong>Sharding</strong></p>

<p>Mongodb sharding is based on shard key.</p>

<p>K1 -&gt; k2 on shard1
K2 -&gt; k3 on shard2 etc..</p>

<p>Each shard is then replicated for higher availability and DR etc..Sharding is therefore range based. Sharding is done per collections basis.Range based sharding helps it do range based queries.</p>


      <p><a href="/2013/11/mongodb-sharding/">Read more...</a></p>
    </li>
    <hr/>
    <li class="post">
      <h1><a href="/2013/11/mongodb-replication/">MongoDB-Replication</a></h1> 
      <div class="meta">
        <p class="posted">04 Nov 2013</p>
        <ul class="categories">
          <li><a href="/category/.net" title=".net">.net</a></li>
          <li><a href="/category/csharp" title="csharp">csharp</a></li>
          <li><a href="/category/mongodb" title="mongodb">mongodb</a></li>
          <li><a href="/category/opensource" title="opensource">opensource</a></li>
        </ul>
      </div>
      <ul class="snow-series"><li><a href="/2013/10/mongodb-ops-stuff/">Part 1 - Ops Stuff</a></li><li><a href="/2013/10/mongodb-indexing/">Part 2 - Indexing</a></li><li><a href="/2013/10/mongodb-understanding-your-queries-through-explainplan/">Part 3 - Explain Plan</a></li><li>Part 4 - Replication</li><li><a href="/2013/11/mongodb-sharding/">Part 5 - Sharding</a></li></ul>
      <p><strong>REPLICATION</strong></p>

<p>Replication helps us achieve availability and fault-tolerance. A replica set is a set of mongo nodes that replicate data amongst each other asynchronously. One of the replica sets is primary while the rest of them will be secondary.
Writes only happen to the primary. If the primary goes down then an election happens and the new primary comes up.
Minimum number of nodes will be 3, since the election requires a majority of the original set.
If there were only 2 sets then the remaining one is not a majority and you would not be able to write.</p>

<p>
      <p><a href="/2013/11/mongodb-replication/">Read more...</a></p>
    </li>
    <hr/>
    <li class="post">
      <h1><a href="/2013/10/review-csharp-indepth/">Review-CSharp in Depth.</a></h1> 
      <div class="meta">
        <p class="posted">23 Oct 2013</p>
        <ul class="categories">
          <li><a href="/category/.net" title=".net">.net</a></li>
          <li><a href="/category/csharp" title="csharp">csharp</a></li>
          <li><a href="/category/book review" title="book review">book review</a></li>
        </ul>
      </div>
      
      <p>I have read the second edition as well. The third edition carries on from there and provides a deeper look in C# 5 and it's key feature async/await. If you want to understand what goes on behind the scenes, this one is for you. Jon Skeet ( yes the famous guy <a href="http://stackoverflow.com/users/22656/jon-skeet" title="Jon Skeet">Jon Skeet</a>) has managed to come out with a great book once again.</p>


      <p><a href="/2013/10/review-csharp-indepth/">Read more...</a></p>
    </li>
    <hr/>
    <li class="post">
      <h1><a href="/2013/10/mongodb-understanding-your-queries-through-explainplan/">MongoDB-Understanding queries through explain plan</a></h1> 
      <div class="meta">
        <p class="posted">13 Oct 2013</p>
        <ul class="categories">
          <li><a href="/category/.net" title=".net">.net</a></li>
          <li><a href="/category/csharp" title="csharp">csharp</a></li>
          <li><a href="/category/mongodb" title="mongodb">mongodb</a></li>
          <li><a href="/category/opensource" title="opensource">opensource</a></li>
        </ul>
      </div>
      <ul class="snow-series"><li><a href="/2013/10/mongodb-ops-stuff/">Part 1 - Ops Stuff</a></li><li><a href="/2013/10/mongodb-indexing/">Part 2 - Indexing</a></li><li>Part 3 - Explain Plan</li><li><a href="/2013/11/mongodb-replication/">Part 4 - Replication</a></li><li><a href="/2013/11/mongodb-sharding/">Part 5 - Sharding</a></li></ul>
      <p>Understanding the queries we write is very critical and MongoDB does a good job here. Developers will find it easy to understand what the queries are doing and where to look for bottlenecks. Well defined parameters and also well documented ones make life a lot easier.
The details have been taken from the mongodb website and presented here for continuity of series.</p>


      <p><a href="/2013/10/mongodb-understanding-your-queries-through-explainplan/">Read more...</a></p>
    </li>
    <hr/>
    <li class="post">
      <h1><a href="/2013/10/mongodb-indexing/">MongoDB-Indexing</a></h1> 
      <div class="meta">
        <p class="posted">06 Oct 2013</p>
        <ul class="categories">
          <li><a href="/category/.net" title=".net">.net</a></li>
          <li><a href="/category/csharp" title="csharp">csharp</a></li>
          <li><a href="/category/mongodb" title="mongodb">mongodb</a></li>
          <li><a href="/category/opensource" title="opensource">opensource</a></li>
        </ul>
      </div>
      <ul class="snow-series"><li><a href="/2013/10/mongodb-ops-stuff/">Part 1 - Ops Stuff</a></li><li>Part 2 - Indexing</li><li><a href="/2013/10/mongodb-understanding-your-queries-through-explainplan/">Part 3 - Explain Plan</a></li><li><a href="/2013/11/mongodb-replication/">Part 4 - Replication</a></li><li><a href="/2013/11/mongodb-sharding/">Part 5 - Sharding</a></li></ul>
      <p>Indexing is one of the most important concepts for any database. Without indexes the mongod process would scan the entire collection and the all the documents it contains to obtain the result of the query. Indexes are defined for the collections and properties as well as sub-fields are supported. Briefly, MongoDB supports the following types of indexes : </p>

<ul>
<li><strong>Single Field Indexes</strong> : Think about having an index on a column in RDBMS.</li>
<li><strong>Compound Indexes</strong>: Think about an having an index on multiple columns in RDBMS.</li>
<li><strong>Multikey Indexes</strong>: This is unique to MongodB, it references an array and succeeds if there is a match for any value in the array.</li>
<li><strong>Geospatial Indexes and Queries</strong> : Allows you to index GeoData. I really don't know much about this to comment. MongoDB website is the best source.</li>
<li><strong>Text Indexes</strong> : For full text search inside a document. Should we use lucene ? Not sure ?</li>
<li><strong>Hashed Index</strong>: Index on hashed contents of the fields.</li>
</ul>


      <p><a href="/2013/10/mongodb-indexing/">Read more...</a></p>
    </li>
    <hr/>
    <li class="post">
      <h1><a href="/2013/10/mongodb-ops-stuff/">MongoDB-Ops-Stuff</a></h1> 
      <div class="meta">
        <p class="posted">05 Oct 2013</p>
        <ul class="categories">
          <li><a href="/category/.net" title=".net">.net</a></li>
          <li><a href="/category/csharp" title="csharp">csharp</a></li>
          <li><a href="/category/mongodb" title="mongodb">mongodb</a></li>
          <li><a href="/category/opensource" title="opensource">opensource</a></li>
        </ul>
      </div>
      <ul class="snow-series"><li>Part 1 - Ops Stuff</li><li><a href="/2013/10/mongodb-indexing/">Part 2 - Indexing</a></li><li><a href="/2013/10/mongodb-understanding-your-queries-through-explainplan/">Part 3 - Explain Plan</a></li><li><a href="/2013/11/mongodb-replication/">Part 4 - Replication</a></li><li><a href="/2013/11/mongodb-sharding/">Part 5 - Sharding</a></li></ul>
      <p>In the previous two posts we have seen some basic querying and how to leverage the querying mechanism to get up and running. Now, we are off in the wild world and we also need to some more complicated stuff.</p>

<p><strong>Creating Indexes</strong>
The api surface is really smooth with this, allowing us to specify the sort order of the indexes and the manner of building them foreground or background.</p>

<pre><code>public void CreateIndex()
{
var QuestionConnectionHandler = new MongoConnectionHandler&lt;Question&gt;("MongoDBDemo");
QuestionConnectionHandler.MongoCollection.EnsureIndex( 
                      IndexKeys.Ascending("Difficulty"), IndexOptions.SetBackground(true));
}
</code></pre>


      <p><a href="/2013/10/mongodb-ops-stuff/">Read more...</a></p>
    </li>
    <hr/>
    <li class="post">
      <h1><a href="/2013/10/mongodb-csharp-driver-part2/">MongoDB-CSharp-Driver Getting organised</a></h1> 
      <div class="meta">
        <p class="posted">04 Oct 2013</p>
        <ul class="categories">
          <li><a href="/category/.net" title=".net">.net</a></li>
          <li><a href="/category/csharp" title="csharp">csharp</a></li>
          <li><a href="/category/mongodb" title="mongodb">mongodb</a></li>
          <li><a href="/category/opensource" title="opensource">opensource</a></li>
        </ul>
      </div>
      <ul class="snow-series"><li><a href="/2013/10/mongodb-csharp-driver-part1/">Part 1 - Using Linq</a></li><li>Part 2 - Getting organised</li><li><a href="/2013/10/mongodb-csharp-driver-part3/">Part 3 - Getting Started</a></li></ul>
      <p>Having done the inital work for talking to MongoDB we can now create some POCO classes and then do some querying on top of it. As usual, my model is Questions and Users.</p>

<pre><code>public class Question : MongoEntity
{
    public string Text { get; set; }
    public string Answer { get; set; }
    public DateTime CreatedOn { get; set; }
    public int Difficulty { get; set; }
}
public class User : MongoEntity
{
    public string Name { get; set; }
    public int Reputation { get; set; }
}
</code></pre>


      <p><a href="/2013/10/mongodb-csharp-driver-part2/">Read more...</a></p>
    </li>
    <hr/>
  </ul> 

  <!-- Pagination links -->
  <div id="post-pagination" class="pagination">

   
      <p class="previous">
        <a href="/">Previous Page</a>
      </p>


    <p class="previous">
      <a href="/page3">Next Page</a>
    </p>

  </div>


                </div>
                <!-- #content -->
            </div>
            <!-- #primary .site-content -->      
        <!-- #main -->

        <footer id="colophon" class="site-footer" role="contentinfo">
            <div class="site-info">
                Powered by <a href="https://github.com/Sandra/Sandra.Snow" rel="generator">Sandra.Snow</a>.	
            </div>
            <!-- .site-info -->
        </footer>
        <!-- #colophon .site-footer -->
    </div>
    <!-- #page .hfeed .site -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src='/javascripts/prettify.js' type='text/javascript'></script>
    
    <script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(['_setAccount', 'UA-46699881-1']);
_gaq.push(['_trackPageview']);
        
(function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
})();
</script>
    
    <script type='text/javascript'>
      $(function () {
        $("pre code").parent().each(function () {
          if (!$(this).hasClass("prettyprint")) {
            $(this).addClass("prettyprint");
            a = true
          }
        });

        prettyPrint();
      });
    </script>
</body>
</html>
