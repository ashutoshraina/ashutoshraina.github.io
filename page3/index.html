<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="last-modified" content="2014-01-18T19:19:59.5425555+05:30" />
    <title>Ashutosh Raina</title>
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
    <link rel="shortcut icon" href="/stylesheets/images/me.png" type="image/png">
    <link rel="shortcut icon" type="image/png" href="/stylesheets/images/me.png" />
    <link rel="canonical" href="http://ashutoshraina.github.io/page3/" />
</head>
<body class="home blog">
    <div id="page" class="hfeed site">
        <header id="masthead" class="site-header fancy-container lightgreen" role="banner">
            <hgroup>
                <h1 class="site-title"><a href="/" title="ashutoshraina.github.io" rel="home">Ashutosh Raina</a></h1>
                <h2 class="site-title"><small>For those who are still chasing</small></h2>
                <p class="site-description">I love french fries!!</p>
            </hgroup>
            <nav role="navigation" class="site-navigation main-navigation">
                <h1 class="assistive-text">Menu</h1>
                <div class="assistive-text skip-link"><a href="#content" title="Skip to content">Skip to    content</a>
                </div>
                <div class="menu">
                    <ul class="display-flex">
                        <li><a href="/about">About</a></li>
                        <li><a href="/category">Categories</a></li>
                        <li><a href="/archive">Archive</a></li>
                        <li><a href="/feed.xml">RSS/Atom</a></li>
                    </ul>
                </div>
            </nav>
        </header>



        <div id="main">

            <div id="primary" class="site-content">
                <div id="content" role="main">
                  

  <ul class="posts">
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/06/entity-framework-table-per-type-gotcha/">Entity Framework - Table Per Type Gotcha</a> 
        <span>posted on 02 Jun 2013</span>
      </h1> 
      
      <p>Entity Framework Table Per Type (TPT) implementation has a little gotcha ( little is really relative ). When we create table per type we will have orphan rows if the parent gets deleted and there will be orphan rows in the parent if the child gets deleted. This causes a funny picture to emerge with very bad consequences.</p>

<p><img src="/stylesheets/images/posts/fix-tpt.png" alt="Gotcha" /></p>

<p>Now, to get around this my simple workaround was to alter the relationships in my seed method.</p>

<pre><code>context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Match] DROP CONSTRAINT [FK_ParikshaDev.Match_ParikshaDev.Questions_QuestionId]" );
context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Match] ADD CONSTRAINT [FK_ParikshaDev.Match_ParikshaDev.Questions_QuestionId] FOREIGN KEY (QuestionId) REFERENCES [ParikshaDev].[Questions] (QuestionId) ON DELETE CASCADE" );

context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Brief] DROP CONSTRAINT [FK_ParikshaDev.Brief_ParikshaDev.Questions_QuestionId]" );
context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Brief] ADD CONSTRAINT [FK_ParikshaDev.Brief_ParikshaDev.Questions_QuestionId] FOREIGN KEY (QuestionId) REFERENCES [ParikshaDev].[Questions] (QuestionId) ON DELETE CASCADE" );

context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Choice] DROP CONSTRAINT [FK_ParikshaDev.Choice_ParikshaDev.Questions_QuestionId]" );
context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Choice] ADD CONSTRAINT [FK_ParikshaDev.Choice_ParikshaDev.Questions_QuestionId] FOREIGN KEY (QuestionId) REFERENCES [ParikshaDev].[Questions] (QuestionId) ON DELETE CASCADE" );

context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Custom] DROP CONSTRAINT [FK_ParikshaDev.Custom_ParikshaDev.Questions_QuestionId]" );
context.Database.ExecuteSqlCommand( @"ALTER TABLE [ParikshaDev].[Custom] ADD CONSTRAINT [FK_ParikshaDev.Custom_ParikshaDev.Questions_QuestionId] FOREIGN KEY (QuestionId) REFERENCES [ParikshaDev].[Questions] (QuestionId) ON DELETE CASCADE" );
</code></pre>

<p><img src="/stylesheets/images/posts/foreign-key.png" alt="ForeignKey" /></p>

<p>There are things that can be better in this code. We can have the Schema name and the Table name statically typed with the help of the context. The relationship name was arrived at by making an educated guess about the relationships and then confirming them by having a look at the db that was generated previously. I would consider this as a bug in EF. I didn't see any way to configure this behaviour with the fluent api. I expected this to be clearly stated in the documentation or a flag or a switch be made available in the api for configuration.</p>

      <p><a href="/2013/06/entity-framework-table-per-type-gotcha/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/05/entity-framework-migrations/">Entity Framework - Migrations</a> 
        <span>posted on 13 May 2013</span>
      </h1> 
      
      <p>Migrations are needed in our day to day work and EF migrations story has become a lot better over the last year. When your database changes rapidly then migrations are needed to keep pace. Ofcourse this is nothing new, but it wasn't available in EF before.</p>

<p><strong>Enable Migrations*</strong></p>

<p>To enable the migrations go to Tools -&gt; Library Package Manager -&gt; Package Manager Console.
Type Enable-Migrations in the console.
-Force parameter is optionally available if you want to overwrite an existing migrations.

      <p><a href="/2013/05/entity-framework-migrations/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/04/console2-commandline-awesomeness/">Console2- Command Line Awesomeness</a> 
        <span>posted on 14 Apr 2013</span>
      </h1> 
      
      <ol>
<li><p>What is this ?
Ever felt that the command prompt fall a little short of your expectations ? You want it to feel like the power toll and not just a tool. </p></li>
<li><p>Where do I get it ?
You can download it from here <a href="http://sourceforge.net/projects/console/" title="Console2">Console2</a></p></li>
<li><p>Help me set it up .<a href="http://www.hanselman.com/blog/Console2ABetterWindowsCommandPrompt.aspx" title="Scott's Blog Post">Scott's Originial Blog Post</a>
Refer to Scott Hansleman's blog post </p></li>
</ol>

<p>Now, if you have successfully managed to get Console2 working note carefully what the last part in Scott's post said 
Console2 is a great little front-end for your existing shell, no matter what it is. Note that Console2 isn't a shell itself, it's just a face on whatever you are already using.</p>

<ol>
<li>Let's make the world a better place by adding Git Bash to the the tabs.</li>
</ol>

<blockquote>
  <p>Title : GitBash</p>
  
  <p>Icon : C:\Program Files (x86)\Git\etc\git.ico</p>
  
  <p>Shell : C:\Program Files (x86)\Git\bin\sh.exe --login -i</p>
  
  <p>Startup dir : c:\Users\Ashutosh ( or whatever your path is )</p>
</blockquote>

<p><img src="/stylesheets/images/posts/console2.png" alt="Console2" /></p>

<p>All looks nice, the world is a better place.</p>

      <p><a href="/2013/04/console2-commandline-awesomeness/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/04/entity-framework-generic-repository-pattern-part-2/">Entity Framework - Generic repository Pattern - Part 2</a> 
        <span>posted on 13 Apr 2013</span>
      </h1> 
      <ul class="snow-series"><li>Part 1 - Generic Repositry Pattern</li><li>Part 2 - Generic Repositry Pattern Contd.</li></ul>
      <p>In the previous post I wrote about an implementation of the Generic Repository pattern for EF. There is so much data on the web that it is difficult to understand what might actually work for you. All of this can drive you 
<a href="http://codereview.stackexchange.com/questions/11785/ef-code-first-with-repository-unitofwork-and-dbcontextfactory?rq=1" title="Crazy">Crazy</a></p>

<p>Throw in my version of crazy as well.
<a href="http://codereview.stackexchange.com/questions/19037/entity-framework-generic-repository-pattern" title="Crazy2">Crazy2</a></p>


      <p><a href="/2013/04/entity-framework-generic-repository-pattern-part-2/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/02/teamcity-recover-admin-password/">TeamCity- Recover Admin Password</a> 
        <span>posted on 04 Feb 2013</span>
      </h1> 
      
      <p>The trials and tribulations of this world are beyond me. Sometimes, a simple gesture can save your life.
I lost(forgot, forgive my small brain it has to keep up with a day job) my TeamCity login details.
Searching online will lead you to this place <a href="http://stackoverflow.com/questions/506115/teamcity-forgotten-admin-password-where-to-look" title="StackOverflow Post">Stackoverflow Post</a>.</p>

<p>The solution there is mighty correct barring two things. One, your TeamCity data directory path is likely to C:\ProgramData\JetBrains\TeamCity\ on a windows box and not C:\users\foo\TeamCity. Second, you need to run CMD as admin.
So,</p>

<pre><code>Step 1 Stop TeamCity service ( either through services.msc or the bat files ).

Step 2  Open CMD as ADMINISTRATOR
(don't forget the admin part you will go bonkers trying to figure out what is happening) and go to C:\TeamCity\webapps\ROOT\WEB-INF\lib

Step 3 type -cp server.jar; hsqldb.jar ChangePassword USERNAME PASSWORD C:\ProgramData\JetBrain\TeamCity
</code></pre>

<p>If all is successful then you password has been reset and you can login. Here's hoping to a few hours saved for anyone who comes around to reading this.</p>

      <p><a href="/2013/02/teamcity-recover-admin-password/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/02/nunit-codesnippet/">NUnit-Code Snippet</a> 
        <span>posted on 03 Feb 2013</span>
      </h1> 
      
      <p>What are we doing ?
We are trying to create a snippet for creating an NUnit test.</p>

<p>How do we do this ?
We go write a snippet.</p>

<p>The snippet is here <a href="https://gist.github.com/4696972" title="NUnit Snippet">Snippet</a></p>

<p>Save it under </p>

<pre><code>..\Documents\Visual Studio 2012\Code Snippets\Visual C#\My Code Snippets
</code></pre>

<p>Now go add the snippet.
Go to Tools in VS -&gt; Code Snippets Manager -&gt; and Import after clicking on the Snippet.
That's it, we are done.</p>

      <p><a href="/2013/02/nunit-codesnippet/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/02/useful-extension-methods/">Useful Extension Methods</a> 
        <span>posted on 03 Feb 2013</span>
      </h1> 
      
      <p>Extension methods provide a very useful way of extending the functionality of a Type (value, reference or interface). The earlier way of extending or rather adding a functionality through inheritance or making an entirely new type from scratch were tedious to say the least. 
Extension methods are basically static methods with the calling syntax same as that of static methods. Over the course of the last few weeks i have come to realise they reduce a lot of repetitiveness from the code when used appropriately.<strong>MSDN</strong> specification also clearly states they must be used sparingly.
So,here are a few useful extension methods.
The syntax has only one new thing, the use of <em>this </em>keyword on the type that the extension method is meant for. </p>

<pre><code>public static XElement ToXElement(this XmlNode node)
{
   var xDoc = new XDocument();
   using (var xmlWriter = xDoc.CreateWriter())
          node.WriteTo(xmlWriter);
   return xDoc.Root;
}
</code></pre>

<p>So, calling the code would be something like ,</p>

<pre><code>var xelement = node.ToXElement();
</code></pre>

<p>xelement is now an XElement. This might look very plain and simple at the outset but when you really start to have a lot of repetitive functionality over a type this could really bail you out and make the code more readable to say the least. For e.g inside a for loop if you have a lot of code that operates over a type then it could be useful to take it to an extension method and then call the extension method statically.Further, extension methods can also have overloads so that is another nifty feature.
The following extension method returns the XmlAttributeCollection for a XmlNode</p>

<pre><code>public static XmlAttributeCollection GetXmlAtrributeCollection(this XmlNode node)
{
    var xmlDoc = new XmlDocument();
    var element = node.ToXElement();
    using (var reader = element.CreateReader())
    {
      xmlDoc.Load(reader);
      return xmlDoc.DocumentElement != null ? xmlDoc.DocumentElement.Attributes : null;
    }
} 
</code></pre>

<p>Too much of XML ?? Lets get one really useful extension method. <a href="http://msdn.microsoft.com/en-us/library/bb460184.aspx" title="Lookup">Lookup</a> is an immutable class in System.Linq. It works similar to a dictionary but does not enforce unique keys , so returns an IEnumerable.
Unfortunately, the creation of a Lookup is internal to .net. So we can only call ToLookup() from a Dictionary etc. So ,i needed some way of adding data to the Lookup.Here is what i came up with. </p>

<pre><code>public class Pairs 
    {
        public String Key { get; set; }
        public Object Value { get; set; }
    }
public static class LookupExtensionMethods
    {
        public static Lookup&lt;String,Object&gt; AddToLookup(this Lookup&lt;String,Object&gt; lookup,
                                                       List&lt;Pairs&gt; pairlist)
        {
            var temp = (Lookup&lt;String, Object&gt;)pairlist.ToLookup(p =&gt; p.Key, p =&gt; p.Value);
            lookup.Concat(temp);
            return lookup;
        }

    public static Lookup&lt;String, Object&gt; AddToLookup(this Lookup&lt;String, Object&gt; lookup, Pairs pair)
    {
        var pairlist = new List&lt;Pairs&gt; {pair};
        var temp = (Lookup&lt;String, Object&gt;)pairlist.ToLookup(p =&gt; p.Key, p =&gt; p.Value);
        lookup.Concat(temp);
        return lookup;
    }
}
</code></pre>

<p>Lastly, there is no way to replace the first occurrence of a string in C# straight out of the box(I bet you did not notice that). </p>

<pre><code> public static string ReplaceFirstOccurrance(this string original, string oldValue, string newValue)
 {
     if (String.IsNullOrEmpty(original))
                return String.Empty;
     if (String.IsNullOrEmpty(oldValue))
                return original;
     if (String.IsNullOrEmpty(newValue))
                newValue = String.Empty;
     var loc = original.IndexOf(oldValue);
     return loc == -1 ? original : original.Remove(loc, oldValue.Length).Insert(loc, newValue);
 }
</code></pre>

<p>Suddenly, the world seems a lot better.</p>

      <p><a href="/2013/02/useful-extension-methods/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/02/entity-framework-6-whats-new/">Entity Framework 6 What's new ?</a> 
        <span>posted on 02 Feb 2013</span>
      </h1> 
      
      <p>EF6 is still in alpha stages but you can go grab it now via nuget.
What is new ?
A whole lot find about it here <a href="http://entityframework.codeplex.com/wikipage?title=Updating%20Applications%20to%20use%20EF6" title="EF6">EF6</a></p>

<p>Also, do read this post about migrating to EF6 if you are migrating an existing application.</p>

<p><a href="http://entityframework.codeplex.com/wikipage?title=Updating%20Applications%20to%20use%20EF6" title="EF6 Migration">EF6 Migration</a></p>

<p>I am basically using the same model to see if life is any easier with V6. The model is fairly simple. There are users, users can questions and questions are of different types. A user creates Test which is composed of many questions.</p>

<p>Earlier, there was no easy way of doing Enum in EF Code First. That limitation is no longer there.
Now, the questions can be of varying difficulty levels so now we can do the following.</p>


      <p><a href="/2013/02/entity-framework-6-whats-new/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/02/entity-framework-generic-repository-pattern-part-1/">Entity Framework - Generic repository Pattern - Part 1</a> 
        <span>posted on 02 Feb 2013</span>
      </h1> 
      <ul class="snow-series"><li>Part 1 - Generic Repositry Pattern</li><li>Part 2 - Generic Repositry Pattern Contd.</li></ul>
      <p>The generic repository pattern has been a matter of discussion on the forums and SO. Developers are not convinced that it solves a problem, yet everyday SO has more questions about the pattern. Clearly, something is not right. I tried to implement the pattern in a way I thought fit. I changed my mind a million times during the process, that tells you that the process was not smooth. You can find several implementations of the pattern scattered all over the internet. I will not pass a opinion on the pattern. I would rather tell you what issues I faced and I how solved (or not) them.

      <p><a href="/2013/02/entity-framework-generic-repository-pattern-part-1/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2011/10/entity-framework-complex-types/">Entity Framework Complex Types</a> 
        <span>posted on 24 Oct 2011</span>
      </h1> 
      
      <p>In complicated models we need complex types to satisfy complex business logic .The most simple example would be having address as a complex type. Complex types are objects with no identity of their own. They are dependent on the parent for their existence. Consider the case where address has no real significance if it is not associated with a customer. This also implies that lazy loading of the complex type is not possible.</p>


      <p><a href="/2011/10/entity-framework-complex-types/">Read more...</a></p>
    </li>
  </ul> 

  <!-- Pagination links -->
  <div id="post-pagination" class="pagination">

   
      <p class="previous">
        <a href="/page2">Previous Page</a>
        </p>


    <p class="previous">
      <a href="/page4">Next Page</a>
    </p>

  </div>


                </div>
                <!-- #content -->
            </div>
            <!-- #primary .site-content -->      

 <div id="secondary" class="widget-area fancy-container lightred" role="complementary">
                <aside id="text-5" class="widget widget_text">
                    <h1 class="widget-title">Follow</h1>
                    <div class="textwidget logos">
                     <a href="https://twitter.com/ashutoshraina" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://twitter.com']);"><img src="/stylesheets/images/twitter.png"></a>
                     <a href="http://stackoverflow.com/users/802070/ashutosh-raina" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://stackoverflow.com']);"><img src="/stylesheets/images/stackoverflow.png"></a>
                    <a href="http://www.linkedin.com/pub/ashutosh-raina/11/165/328" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://www.linkedin.com']);"><img src="/stylesheets/images/linkedin.png"></a>                      
                    <a href="https://github.com/ashutoshraina" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://github.com']);"><img src="/stylesheets/images/github.png"></a>
                       
                  
                    </div>
                   <a href="http://stackexchange.com/users/422979">
<img src="http://stackexchange.com/users/flair/422979.png" width="208" height="58" alt="profile for ashutosh raina on Stack Exchange, a network of free, community-driven Q&A sites" title="profile for ashutosh raina on Stack Exchange, a network of free, community-driven Q&A sites">
</a>  
                
                <aside id="linkcat-6" class="widget widget_links">
                    <h1 class="widget-title">Other Blogs</h1>
                    <ul class='xoxo blogroll'>
                        <li><a href="http://www.hanselman.com/blog" target="_top" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://hanselman.com/']);">Scott Hanselman</a></li>
                        <li><a href="http://www.2guysfrommumbai.wordpress.com/" target="_top" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://www.2guysfrommumbai.wordpress.com']);">My Old blog</a></li>                        
                    </ul>
                    
                </aside>
                <aside id="archives-4" class="widget widget_archive">
                    <h1 class="widget-title">Archive</h1>
                    <ul class="posts">
                          <li><a href="/archive#2014January">January, 2014</a></li>
                          <li><a href="/archive#2013December">December, 2013</a></li>
                          <li><a href="/archive#2013November">November, 2013</a></li>
                          <li><a href="/archive#2013October">October, 2013</a></li>
                          <li><a href="/archive#2013September">September, 2013</a></li>
                          <li><a href="/archive#2013July">July, 2013</a></li>
                          <li><a href="/archive#2013June">June, 2013</a></li>
                          <li><a href="/archive#2013May">May, 2013</a></li>
                          <li><a href="/archive#2013April">April, 2013</a></li>
                          <li><a href="/archive#2013February">February, 2013</a></li>
                          <li><a href="/archive#2011October">October, 2011</a></li>
                    </ul>
                </aside>
            </div>
            <!-- #secondary .widget-area -->

        </div>
        <!-- #main -->

        <footer id="colophon" class="site-footer" role="contentinfo">
            <div class="site-info">
                Powered by <a href="https://github.com/Sandra/Sandra.Snow" rel="generator">Sandra.Snow</a>.	
            </div>
            <!-- .site-info -->
        </footer>
        <!-- #colophon .site-footer -->
    </div>
    <!-- #page .hfeed .site -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src='/javascripts/prettify.js' type='text/javascript'></script>
    
    <script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(['_setAccount', 'UA-46699881-1']);
_gaq.push(['_trackPageview']);
        
(function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
})();
</script>
    
    <script type='text/javascript'>
      $(function () {
        $("pre code").parent().each(function () {
          if (!$(this).hasClass("prettyprint")) {
            $(this).addClass("prettyprint");
            a = true
          }
        });

        prettyPrint();
      });
    </script>
</body>
</html>
