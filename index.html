<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="last-modified" content="2014-01-28T21:11:16.7524971+05:30" />
    <title>Ashutosh Raina</title>
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
    <link rel="shortcut icon" href="/stylesheets/images/me.png" type="image/png">
    <link rel="shortcut icon" type="image/png" href="/stylesheets/images/me.png" />
    <link rel="canonical" href="http://ashutoshraina.github.io/" />
</head>
<body class="home blog">
    <div id="page" class="hfeed site">
        <header id="masthead" class="site-header fancy-container lightgreen" role="banner">
            <hgroup>
                <h1 class="site-title"><a href="/" title="ashutoshraina.github.io" rel="home">Ashutosh Raina</a></h1>
                <h2 class="site-title"><small>For those who are still chasing</small></h2>
                <p class="site-description">I love french fries!!</p>
            </hgroup>
            <nav role="navigation" class="site-navigation main-navigation">
                <h1 class="assistive-text">Menu</h1>
                <div class="assistive-text skip-link"><a href="#content" title="Skip to content">Skip to    content</a>
                </div>
                <div class="menu">
                    <ul class="display-flex">
                        <li><a href="/about">About</a></li>
                        <li><a href="/category">Categories</a></li>
                        <li><a href="/archive">Archive</a></li>
                        <li><a href="/feed.xml">RSS/Atom</a></li>
                    </ul>
                </div>
            </nav>
        </header>



        <div id="main">

            <div id="primary" class="site-content">
                <div id="content" role="main">
                  

  <ul class="posts">
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2014/01/learning-redis-by-accident/">Learning Redis by accident</a> 
        <span>posted on 27 Jan 2014</span>
      </h1> 
      
      <p>While exploring the pub-sub mechanism in MongoDB, I came across Redis. Redis has this built in. This gave me the incentive to scratch a long time itch and try redis. Redis is eseentially an in-memory database. It is supposed to be fast (like really fast). So, I thought I would take it for a spin. Considering, I am on windows and it seems like there is no direct support for windows. Windows remains the poor second, but we will let it be for now.
Microsoft provides the executable for 2.6 and we can download it from there.</p>

<p><!--excerpt-></p>

<p>Now, how do we talk to redis ? First, as expected there is a CLI which is quite simple and easy. Second, get some packages from nuget and start writing C#. I tried the CLI for an hour or so and then moved on to C#. (CLI is no slouch, you can do a pub-sub there). The things you can do with redis are simple and few. That is not a such a bad thing because it keeps the clutter out. It does a few things and does them really well and really fast.
Now, for talking to redis there are two primary options BookSleeve (by Marc Garvel) and ServiceStack.Redis. I chose the former just for the name(no kidding naming is still a hard problem).</p>

<p>Let's get to the coding bit.
Open up a connection, insert something and get something back.</p>

<pre><code>RedisConnection connection = new RedisConnection("localhost");
connection.Open();
//0 is the database number, you can set it whatever you want
connection.Strings.Set(0, "foo", "bar");
var bar = connection.Strings.GetString(0, "foo");
</code></pre>

<p>Now, before we move further just for clarity Redis supports the following data structures.</p>

<pre><code>Strings
Hashes
Lists
Sets
Sorted-Sets
</code></pre>

<p>The api surface in booksleeve brings the simplicity of redis to the surface.</p>

<pre><code>connection.Hashes.Set(0, "duck", new Dictionary&lt;string,byte[]&gt;{ { "quack", Encoding.UTF8.GetBytes("I am a quack") } });
var quack = connection.Hashes.GetString(0, "duck", "quack");
Console.WriteLine(quack.Result);

connection.Lists.AddFirst(0, "baz", "bazz");
var bazz = connection.Lists.GetString(0, "baz", 0);
Console.WriteLine(bazz.Result);
</code></pre>

<p>Another, interesting feature of redis is the ability to expire data. This can be quite handy especially when cache needs to be invalidated.</p>

<pre><code>connection.Strings.Set(0, "temp", "aboutToExpire", 4);
var temp = connection.Strings.GetString(0, "temp");
Console.WriteLine(temp.Result);
Thread.Sleep(4000);
temp = connection.Strings.GetString(0, "temp");
Console.WriteLine(string.IsNullOrEmpty(temp.Result));
</code></pre>

<p>Publish and subscribe was surprisingly terse.</p>

<pre><code>connection.Publish("topic", "Hello From Pub");

var channel = connection.GetOpenSubscriberChannel();
channel.Subscribe("topic", SubscritionCallback);

private static void SubscritionCallback (string key,byte[] message) {
Console.WriteLine(key);
Console.WriteLine(Encoding.UTF8.GetString((message)));
}
</code></pre>

<p>This wasn't so hard and can be quite useful in situation where you simply need to hold data and not pay the penalty of going back to a full database again and again. I enjoyed writing about redis, hope you like reading it.</p>

      <p><a href="/2014/01/learning-redis-by-accident/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2014/01/mongodb-pubsub/">Pub Sub with MongoDB</a> 
        <span>posted on 23 Jan 2014</span>
      </h1> 
      
      <p>In the spirit of trying out new thigns I wanted to create a pub0sub system with mongodb. Usually we would create a pub sub system with a message queue, but since we are a little crazy we will try and do it this way. Turns out it is quite simple. Before we begin we must understand somethings that are available uniquely in MongoDB.

      <p><a href="/2014/01/mongodb-pubsub/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2014/01/optimistic-concurrency-mongodb/">MongoDb: Optimistic Concurrency</a> 
        <span>posted on 18 Jan 2014</span>
      </h1> 
      
      <p>Optimistic concurrency is one something that most of us need in our applications. What follows is a simple example on how to achieve it in MongoDB.
First, a really simple document.</p>

<p>Note : This post uses a lot of code that I have shown in previous posts, please look at them if there is any confusion. The principles remain simple and can be used without using the code shown below.</p>


      <p><a href="/2014/01/optimistic-concurrency-mongodb/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2014/01/querying-oplog-mongodb/">MongoDb: Querying the OpLog</a> 
        <span>posted on 10 Jan 2014</span>
      </h1> 
      
      <p>Back to MongoDB after some time. OpLog has always been a curious case for me. To know more about it let's start to our detective work.</p>

<p><strong>What is the OpLog?</strong></p>

<p>The mongodb website gives a rather long definition. I will quote that </p>

<blockquote>
  <p>The oplog (operations log) is a special capped collection that keeps a rolling record of all operations that modify the data stored in your databases. MongoDB applies database operations on the primary and then records the operations on the primaryâ€™s oplog. The secondary members then copy and apply these operations in an asynchronous process. All replica set members contain a copy of the oplog, allowing them to maintain the current state of the database.</p>
  
  <p>To facilitate replication, all replica set members send heartbeats (pings) to all other members. Any member can import oplog entries from any other member.
  Whether applied once or multiple times to the target dataset, each operation in the oplog produces the same results, i.e. each operation in the oplog is idempotent. For proper replication operations, entries in the oplog must be idempotent:</p>
</blockquote>

<ul>
<li>initial sync</li>
<li>post-rollback catch-up</li>
<li>sharding chunk migrations</li>
</ul>

<p>
      <p><a href="/2014/01/querying-oplog-mongodb/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2014/01/mvc-on-mono-monodevelop/">Up and Running with Asp.net MVC Mono and Monodevelop</a> 
        <span>posted on 03 Jan 2014</span>
      </h1> 
      
      <p>After 3 hours worth of work, I was finally able to run Asp.net MVC4 using monodevelop on mono. I will talk about installaing monodevelop later (that was a painful exercise). So, assuming you have monodevelop installed on windows and latest version of mono installed (mono-3.2.3)as well. Now, go file new solution Asp.net MVC project with razor. Run it and wait for the world to fall apart.</p>


      <p><a href="/2014/01/mvc-on-mono-monodevelop/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/12/tasks-with-timeout-net4.5-contd/">Tasks With Timeout On .net 4.5 Contd.</a> 
        <span>posted on 30 Dec 2013</span>
      </h1> 
      <ul class="snow-series"><li><a href="/2013/12/tasks-with-timeouts/">Part 1 - Tasks With Timeouts</a></li><li><a href="/2013/12/tasks-with-timeout-contd/">Part 2 - Tasks With Timeouts contd.</a></li><li>Part 3 - Tasks With Timeout on .net4.5</li></ul>
      <p>The previous two posts looked at creating tasks with timeouts on .net4. The code as expected took some heavy lifting to get going. Understanding the extension methods themselves took some time. Today, using .net 4.5 this can be made a lot easier. Can we do better ? Yes we can !!</p>

<pre><code>    public static Task WithTimeout(this Task task, TimeSpan timeout)
    {
        var delay = task.ContinueWith(t =&gt; { }, new CancellationTokenSource(timeout).Token);
        return Task.WhenAny(task, delay).Unwrap();
    }
    public static Task&lt;T&gt; WithTimeout&lt;T&gt;(this Task&lt;T&gt; task, TimeSpan timeout)
    {            
        var delay = task.ContinueWith(t =&gt; t.Result, new CancellationTokenSource(timeout).Token);
        return Task.WhenAny(task, delay).Unwrap();
    }
</code></pre>

<p>
      <p><a href="/2013/12/tasks-with-timeout-net4.5-contd/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/12/tasks-with-timeout-contd/">Tasks With Timeout Contd.</a> 
        <span>posted on 24 Dec 2013</span>
      </h1> 
      <ul class="snow-series"><li><a href="/2013/12/tasks-with-timeouts/">Part 1 - Tasks With Timeouts</a></li><li>Part 2 - Tasks With Timeouts contd.</li><li><a href="/2013/12/tasks-with-timeout-net4.5-contd/">Part 3 - Tasks With Timeout on .net4.5</a></li></ul>
      <p>As mentioned in the last post we can now have tasks with individual timeouts. The code looked a little heavy. Can we do better ? Yes we can !!</p>

<pre><code>    var tasks = new List&lt;Task&gt;();
    try
    {
    //instead of checking for fault within the continutaion, 
    //we can just use a TaskContinuationOption to tell communicate the right semantics

    var t1 = Task.Factory.StartNew(_ =&gt; LongRunningTask(),TaskCreationOptions.AttachedToParent)
    .TimeoutAfter(1000)
    .ContinueWith(t =&gt; SomethingUsefulWithTheResult(), 
     TaskContinuationOptions.NotOnFaulted);

    var t2 = Task.Factory.StartNew(_ =&gt; LongRunningTask(), TaskCreationOptions.AttachedToParent)
      .ContinueWith(t =&gt; SomethingUsefulWithTheResult());

    var t3 = Task.Factory.StartNew(_ =&gt; LongRunningTask("Entering task3"),
    TaskCreationOptions.AttachedToParent)
      .ContinueWith(t =&gt; SomethingUsefulWithTheResult());

    tasks.Add(t1);
    tasks.Add(t2);
    tasks.Add(t3);

    Task.WaitAll(tasks.ToArray());
    }
    catch (Exception ex)
    {
    Console.WriteLine("There was an exception");
    Console.WriteLine(ex.InnerException.Message);   
    }
</code></pre>

<p>I will show in the next post how this wasn't all that better since this leaves a few gaps.</p>

      <p><a href="/2013/12/tasks-with-timeout-contd/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/12/tasks-with-timeouts/">Tasks With Timeout</a> 
        <span>posted on 23 Dec 2013</span>
      </h1> 
      <ul class="snow-series"><li>Part 1 - Tasks With Timeouts</li><li><a href="/2013/12/tasks-with-timeout-contd/">Part 2 - Tasks With Timeouts contd.</a></li><li><a href="/2013/12/tasks-with-timeout-net4.5-contd/">Part 3 - Tasks With Timeout on .net4.5</a></li></ul>
      <p>So the task is to timeout a task. now, I never thought it would take me as long as it did. Turns out it is a really tricky problem problem. I was expecting something within the framework to make life easier, there isn't anything by default but msdn to the rescue 
<a href="http://blogs.msdn.com/b/pfxteam/archive/2011/11/10/10235834.aspx" title="Tasks With Timeout">Tasks With Timeouts</a></p>


      <p><a href="/2013/12/tasks-with-timeouts/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/11/mongodb-sharding/">MongoDB-Sharding</a> 
        <span>posted on 05 Nov 2013</span>
      </h1> 
      <ul class="snow-series"><li><a href="/2013/10/mongodb-ops-stuff/">Part 1 - Ops Stuff</a></li><li><a href="/2013/10/mongodb-indexing/">Part 2 - Indexing</a></li><li><a href="/2013/10/mongodb-understanding-your-queries-through-explainplan/">Part 3 - Explain Plan</a></li><li><a href="/2013/11/mongodb-replication/">Part 4 - Replication</a></li><li>Part 5 - Sharding</li></ul>
      <p><strong>Sharding</strong></p>

<p>Mongodb sharding is based on shard key.</p>

<p>K1 -&gt; k2 on shard1
K2 -&gt; k3 on shard2 etc..</p>

<p>Each shard is then replicated for higher availability and DR etc..Sharding is therefore range based. Sharding is done per collections basis.Range based sharding helps it do range based queries.</p>


      <p><a href="/2013/11/mongodb-sharding/">Read more...</a></p>
    </li>
    <li class="fancy-container lightblue">
      <h1>
        <a href="/2013/11/mongodb-replication/">MongoDB-Replication</a> 
        <span>posted on 04 Nov 2013</span>
      </h1> 
      <ul class="snow-series"><li><a href="/2013/10/mongodb-ops-stuff/">Part 1 - Ops Stuff</a></li><li><a href="/2013/10/mongodb-indexing/">Part 2 - Indexing</a></li><li><a href="/2013/10/mongodb-understanding-your-queries-through-explainplan/">Part 3 - Explain Plan</a></li><li>Part 4 - Replication</li><li><a href="/2013/11/mongodb-sharding/">Part 5 - Sharding</a></li></ul>
      <p><strong>REPLICATION</strong></p>

<p>Replication helps us achieve availability and fault-tolerance. A replica set is a set of mongo nodes that replicate data amongst each other asynchronously. One of the replica sets is primary while the rest of them will be secondary.
Writes only happen to the primary. If the primary goes down then an election happens and the new primary comes up.
Minimum number of nodes will be 3, since the election requires a majority of the original set.
If there were only 2 sets then the remaining one is not a majority and you would not be able to write.</p>

<p>
      <p><a href="/2013/11/mongodb-replication/">Read more...</a></p>
    </li>
  </ul> 

  <!-- Pagination links -->
  <div id="post-pagination" class="pagination">

   

      <!--<a href="/">Previous Page</a>-->

    <p class="previous">
      <a href="/page2">Next Page</a>
    </p>

  </div>


                </div>
                <!-- #content -->
            </div>
            <!-- #primary .site-content -->      

 <div id="secondary" class="widget-area fancy-container lightred" role="complementary">
                <aside id="text-5" class="widget widget_text">
                    <h1 class="widget-title">Follow</h1>
                    <div class="textwidget logos">
                     <a href="https://twitter.com/ashutoshraina" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://twitter.com']);"><img src="/stylesheets/images/twitter.png"></a>
                     <a href="http://stackoverflow.com/users/802070/ashutosh-raina" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://stackoverflow.com']);"><img src="/stylesheets/images/stackoverflow.png"></a>
                    <a href="http://www.linkedin.com/pub/ashutosh-raina/11/165/328" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://www.linkedin.com']);"><img src="/stylesheets/images/linkedin.png"></a>                      
                    <a href="https://github.com/ashutoshraina" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://github.com']);"><img src="/stylesheets/images/github.png"></a>
                       
                  
                    </div>
                   <a href="http://stackexchange.com/users/422979">
<img src="http://stackexchange.com/users/flair/422979.png" width="208" height="58" alt="profile for ashutosh raina on Stack Exchange, a network of free, community-driven Q&A sites" title="profile for ashutosh raina on Stack Exchange, a network of free, community-driven Q&A sites">
</a>  
                
                <aside id="linkcat-6" class="widget widget_links">
                    <h1 class="widget-title">Other Blogs</h1>
                    <ul class='xoxo blogroll'>
                        <li><a href="http://www.hanselman.com/blog" target="_top" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://hanselman.com/']);">Scott Hanselman</a></li>
                        <li><a href="http://www.2guysfrommumbai.wordpress.com/" target="_top" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://www.2guysfrommumbai.wordpress.com']);">My Old blog</a></li>                        
                    </ul>
                    
                </aside>
                <aside id="archives-4" class="widget widget_archive">
                    <h1 class="widget-title">Archive</h1>
                    <ul class="posts">
                          <li><a href="/archive#2014January">January, 2014</a></li>
                          <li><a href="/archive#2013December">December, 2013</a></li>
                          <li><a href="/archive#2013November">November, 2013</a></li>
                          <li><a href="/archive#2013October">October, 2013</a></li>
                          <li><a href="/archive#2013September">September, 2013</a></li>
                          <li><a href="/archive#2013July">July, 2013</a></li>
                          <li><a href="/archive#2013June">June, 2013</a></li>
                          <li><a href="/archive#2013May">May, 2013</a></li>
                          <li><a href="/archive#2013April">April, 2013</a></li>
                          <li><a href="/archive#2013February">February, 2013</a></li>
                          <li><a href="/archive#2011October">October, 2011</a></li>
                    </ul>
                </aside>
            </div>
            <!-- #secondary .widget-area -->

        </div>
        <!-- #main -->

        <footer id="colophon" class="site-footer" role="contentinfo">
            <div class="site-info">
                Powered by <a href="https://github.com/Sandra/Sandra.Snow" rel="generator">Sandra.Snow</a>.	
            </div>
            <!-- .site-info -->
        </footer>
        <!-- #colophon .site-footer -->
    </div>
    <!-- #page .hfeed .site -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src='/javascripts/prettify.js' type='text/javascript'></script>
    
    <script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(['_setAccount', 'UA-46699881-1']);
_gaq.push(['_trackPageview']);
        
(function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
})();
</script>
    
    <script type='text/javascript'>
      $(function () {
        $("pre code").parent().each(function () {
          if (!$(this).hasClass("prettyprint")) {
            $(this).addClass("prettyprint");
            a = true
          }
        });

        prettyPrint();
      });
    </script>
</body>
</html>
